# Generated by https://github.com/anoru/data-ci-cd-template

# Install dependencies, create coverage tests and run Pytest Coverage Commentator.
# For more information, see: https://github.com/coroo/pytest-coverage-commentator

name: test-coverage
on: [pull_request]
jobs:
  test-coverage:
    name: test-coverage
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v2
      - name: Setup Python 3.8
        uses: actions/setup-python@v2
        with:
          python-version: 3.8
      - name: Install development dependencies
        run: pip install -r requirements-dev.txt
      - name: Install the {project_slug_under} package
        run: pip install .
      - name: Run unit tests. Print the result to the console and save it in a text file as well.
        run: pytest --cov={project_slug_under} --cov-report term-missing | tee pytest-coverage.txt
      - name: Comment coverage
        uses: coroo/pytest-coverage-commentator@v1.0.2
      - name: fail-if-coverage-is-lower-than-requested
        run: |
          FULL_COVERAGE=`cat pytest-coverage.txt | grep "TOTAL" | grep -E "([0-9]+)%" --only-matching | grep -E "([0-9]+)" --only-matching`
          (($FULL_COVERAGE >= 90))


# Run tests against the installed package and make sure they all pass.
# For more information, see: https://github.com/pre-commit/action

name: unit-tests
on: [push]
jobs:
  unit-tests:
    name: unit-tests
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v2
      - name: Setup Python 3.8
        uses: actions/setup-python@v2
        with:
          python-version: 3.8
      - name: Install development dependencies
        run: pip install -r requirements-dev.txt
      - name: Install the {project_slug_under} package
        run: pip install .
      - name: Run unit tests
        run: pytest
